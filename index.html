<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片文字编辑器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#FF7D00',
            neutral: {
              100: '#F5F7FA',
              200: '#E5E6EB',
              300: '#C9CDD4',
              400: '#86909C',
              500: '#4E5969',
              600: '#272E3B',
              700: '#1D2129',
            }
          },
          fontFamily: {
            inter: ['Inter', sans-serif],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .backdrop-blur-sm {
        backdrop-filter: blur(4px);
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .text-shadow-lg {
        text-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
      }
      .draggable-text {
        position: absolute;
        cursor: move;
        user-select: none;
        white-space: nowrap;
      }
      .resizable {
        resize: both;
        overflow: auto;
      }
    }
  </style>
</head>
<body class="font-inter bg-neutral-100 text-neutral-700 min-h-screen flex flex-col">
  <!-- 导航栏 -->
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-neutral-200 shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <a href="#" class="flex items-center">
            <i class="fa fa-picture-o text-primary text-2xl mr-2"></i>
            <span class="font-bold text-xl text-neutral-700">图片文字编辑器</span>
          </a>
        </div>
        <div class="hidden md:flex items-center space-x-4">
          <button id="save-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg">
            <i class="fa fa-save mr-1"></i>保存图片
          </button>
        </div>
        <div class="md:hidden">
          <button id="mobile-menu-button" class="text-neutral-500 hover:text-primary">
            <i class="fa fa-bars text-xl"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- 移动端菜单 -->
    <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-neutral-200">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        <button id="save-btn-mobile" class="w-full bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg">
          <i class="fa fa-save mr-1"></i>保存图片
        </button>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- 左侧控制面板 -->
      <div class="lg:col-span-1 space-y-6">
        <!-- 上传区域 -->
        <div class="bg-white rounded-xl shadow-md p-6 border border-neutral-200">
          <h2 class="text-lg font-semibold text-neutral-700 mb-4">上传图片</h2>
          <div class="space-y-4">
            <div>
              <div id="image-upload-container" class="border-2 border-dashed border-neutral-300 rounded-lg p-6 text-center hover:border-primary transition-colors duration-200 cursor-pointer">
                <input type="file" id="image-upload" class="hidden" accept="image/*">
                <i class="fa fa-cloud-upload text-3xl text-neutral-400 mb-2"></i>
                <p class="text-sm text-neutral-500">点击或拖拽图片到这里</p>
                <p class="text-xs text-neutral-400 mt-1">支持 JPG, PNG, WebP 格式</p>
              </div>
              <div id="image-preview" class="hidden mt-3">
                <img id="preview-img" src="" alt="图片预览" class="w-full h-auto object-cover rounded-lg">
                <button id="remove-image-btn" class="mt-2 text-xs text-red-500 hover:text-red-600">
                  <i class="fa fa-trash-o mr-1"></i>移除图片
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 文字设置 -->
        <div class="bg-white rounded-xl shadow-md p-6 border border-neutral-200">
          <h2 class="text-lg font-semibold text-neutral-700 mb-4">添加文字</h2>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-neutral-500 mb-1">文字内容</label>
              <textarea id="text-content" rows="2" placeholder="输入要添加的文字" class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors duration-200 outline-none"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-sm font-medium text-neutral-500 mb-1">字体大小</label>
                <input type="number" id="font-size" value="24" min="8" max="100" class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary transition-colors duration-200 outline-none">
              </div>
              <div>
                <label class="block text-sm font-medium text-neutral-500 mb-1">文字颜色</label>
                <input type="color" id="text-color" value="#FFFFFF" class="w-full h-10 px-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-neutral-500 mb-1">文字对齐</label>
              <div class="flex space-x-2">
                <button class="text-align-btn flex-1 py-2 px-3 bg-white border border-neutral-300 rounded-lg hover:border-primary/50 transition-colors duration-200" data-align="left">
                  <i class="fa fa-align-left"></i>
                </button>
                <button class="text-align-btn flex-1 py-2 px-3 bg-primary/10 border border-primary text-primary rounded-lg" data-align="center">
                  <i class="fa fa-align-center"></i>
                </button>
                <button class="text-align-btn flex-1 py-2 px-3 bg-white border border-neutral-300 rounded-lg hover:border-primary/50 transition-colors duration-200" data-align="right">
                  <i class="fa fa-align-right"></i>
                </button>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-neutral-500 mb-1">文字样式</label>
              <div class="flex space-x-2">
                <button id="bold-btn" class="text-style-btn flex-1 py-2 px-3 bg-white border border-neutral-300 rounded-lg hover:border-primary/50 transition-colors duration-200">
                  <i class="fa fa-bold"></i>
                </button>
                <button id="italic-btn" class="text-style-btn flex-1 py-2 px-3 bg-white border border-neutral-300 rounded-lg hover:border-primary/50 transition-colors duration-200">
                  <i class="fa fa-italic"></i>
                </button>
                <button id="underline-btn" class="text-style-btn flex-1 py-2 px-3 bg-white border border-neutral-300 rounded-lg hover:border-primary/50 transition-colors duration-200">
                  <i class="fa fa-underline"></i>
                </button>
                <button id="shadow-btn" class="text-style-btn flex-1 py-2 px-3 bg-white border border-neutral-300 rounded-lg hover:border-primary/50 transition-colors duration-200">
                  <i class="fa fa-moon-o"></i>
                </button>
              </div>
            </div>
            
            <button id="add-text-btn" class="w-full bg-primary hover:bg-primary/90 text-white py-2 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg flex items-center justify-center">
              <i class="fa fa-plus mr-1"></i>添加文字
            </button>
          </div>
        </div>
        
        <!-- 文字列表 -->
        <div class="bg-white rounded-xl shadow-md p-6 border border-neutral-200">
          <h2 class="text-lg font-semibold text-neutral-700 mb-4">文字元素</h2>
          <div id="text-elements-list" class="space-y-2 max-h-60 overflow-y-auto scrollbar-hide">
            <div class="text-center text-neutral-400 text-sm py-4">
              暂无文字元素
            </div>
          </div>
        </div>
      </div>
      
      <!-- 右侧预览区域 -->
      <div class="lg:col-span-3">
        <div class="bg-white rounded-xl shadow-md p-6 border border-neutral-200 h-full flex flex-col">
          <h2 class="text-lg font-semibold text-neutral-700 mb-4">图片预览</h2>
          
          <!-- 预览工具栏 -->
          <div class="flex justify-between items-center mb-4">
            <div class="flex space-x-2">
              <button class="preview-btn px-3 py-1.5 bg-white border border-neutral-300 rounded-lg text-sm hover:border-primary/50 transition-colors duration-200">
                <i class="fa fa-search-minus mr-1"></i>缩小
              </button>
              <button class="preview-btn px-3 py-1.5 bg-white border border-neutral-300 rounded-lg text-sm hover:border-primary/50 transition-colors duration-200">
                <i class="fa fa-search-plus mr-1"></i>放大
              </button>
              <button class="preview-btn px-3 py-1.5 bg-white border border-neutral-300 rounded-lg text-sm hover:border-primary/50 transition-colors duration-200">
                <i class="fa fa-arrows-alt mr-1"></i>实际大小
              </button>
            </div>
            <button id="download-btn" class="px-3 py-1.5 bg-primary hover:bg-primary/90 text-white rounded-lg text-sm shadow-md hover:shadow-lg transition-colors duration-200 flex items-center">
              <i class="fa fa-download mr-2"></i>下载图片
            </button>
          </div>
          
          <!-- 图片预览区域 -->
          <div class="flex-grow bg-neutral-100 rounded-lg overflow-hidden flex items-center justify-center relative">
            <div id="image-container" class="bg-white shadow-xl rounded-lg overflow-hidden transition-all duration-300 transform scale-75 cursor-move relative" style="width: 800px; height: 600px;">
              <!-- 图片 -->
              <div id="image-wrapper" class="absolute inset-0">
                <img id="main-image" src="https://picsum.photos/800/600" alt="主图片" class="w-full h-full object-cover">
              </div>
              
              <!-- 文字元素将在这里动态添加 -->
              <div id="text-layer" class="absolute inset-0 pointer-events-none"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-neutral-700 text-white py-8 mt-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-lg font-semibold mb-4">图片文字编辑器</h3>
          <p class="text-neutral-300 text-sm">简单易用的图片文字编辑工具，直接在图片上添加文字并下载保存。</p>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">快速链接</h3>
          <ul class="space-y-2 text-sm">
            <li><a href="#" class="text-neutral-300 hover:text-white transition-colors duration-200">使用教程</a></li>
            <li><a href="#" class="text-neutral-300 hover:text-white transition-colors duration-200">常见问题</a></li>
            <li><a href="#" class="text-neutral-300 hover:text-white transition-colors duration-200">联系我们</a></li>
          </ul>
        </div>
      </div>
      <div class="border-t border-neutral-600 mt-8 pt-8 text-center text-neutral-400 text-sm">
        <p>&copy; 2025 图片文字编辑器. 保留所有权利.</p>
      </div>
    </div>
  </footer>

  <!-- 脚本 -->
  <script>
    // 移动端菜单切换
    document.getElementById('mobile-menu-button').addEventListener('click', function() {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
    });
    
    // 图片上传
    const imageUploadContainer = document.getElementById('image-upload-container');
    const imageUpload = document.getElementById('image-upload');
    const imagePreview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const removeImageBtn = document.getElementById('remove-image-btn');
    const mainImage = document.getElementById('main-image');
    
    imageUploadContainer.addEventListener('click', () => imageUpload.click());
    
    imageUpload.addEventListener('change', function(e) {
      if (this.files && this.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          previewImg.src = e.target.result;
          mainImage.src = e.target.result;
          imagePreview.classList.remove('hidden');
        }
        
        reader.readAsDataURL(this.files[0]);
      }
    });
    
    removeImageBtn.addEventListener('click', function() {
      imageUpload.value = '';
      imagePreview.classList.add('hidden');
      // 恢复默认图片
      mainImage.src = 'https://picsum.photos/800/600';
    });
    
    // 文字样式设置
    let currentTextStyle = {
      fontSize: 24,
      color: '#FFFFFF',
      align: 'center',
      bold: false,
      italic: false,
      underline: false,
      shadow: false
    };
    
    // 文字对齐按钮
    const textAlignBtns = document.querySelectorAll('.text-align-btn');
    textAlignBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        // 移除所有按钮的选中状态
        textAlignBtns.forEach(b => {
          b.classList.remove('bg-primary/10', 'border-primary', 'text-primary');
          b.classList.add('bg-white', 'border-neutral-300');
        });
        
        // 添加当前按钮的选中状态
        this.classList.remove('bg-white', 'border-neutral-300');
        this.classList.add('bg-primary/10', 'border-primary', 'text-primary');
        
        // 更新样式
        currentTextStyle.align = this.dataset.align;
      });
    });
    
    // 文字样式按钮
    const boldBtn = document.getElementById('bold-btn');
    const italicBtn = document.getElementById('italic-btn');
    const underlineBtn = document.getElementById('underline-btn');
    const shadowBtn = document.getElementById('shadow-btn');
    
    boldBtn.addEventListener('click', function() {
      currentTextStyle.bold = !currentTextStyle.bold;
      this.classList.toggle('bg-primary/10');
      this.classList.toggle('border-primary');
      this.classList.toggle('text-primary');
    });
    
    italicBtn.addEventListener('click', function() {
      currentTextStyle.italic = !currentTextStyle.italic;
      this.classList.toggle('bg-primary/10');
      this.classList.toggle('border-primary');
      this.classList.toggle('text-primary');
    });
    
    underlineBtn.addEventListener('click', function() {
      currentTextStyle.underline = !currentTextStyle.underline;
      this.classList.toggle('bg-primary/10');
      this.classList.toggle('border-primary');
      this.classList.toggle('text-primary');
    });
    
    shadowBtn.addEventListener('click', function() {
      currentTextStyle.shadow = !currentTextStyle.shadow;
      this.classList.toggle('bg-primary/10');
      this.classList.toggle('border-primary');
      this.classList.toggle('text-primary');
    });
    
    // 字体大小和颜色
    const fontSizeInput = document.getElementById('font-size');
    const textColorInput = document.getElementById('text-color');
    
    fontSizeInput.addEventListener('input', function() {
      currentTextStyle.fontSize = parseInt(this.value);
    });
    
    textColorInput.addEventListener('input', function() {
      currentTextStyle.color = this.value;
    });
    
    // 文字元素列表
    let textElements = [];
    let nextTextId = 1;
    let selectedTextElement = null;
    
    // 添加文字按钮
    const addTextBtn = document.getElementById('add-text-btn');
    const textContent = document.getElementById('text-content');
    const textLayer = document.getElementById('text-layer');
    const textElementsList = document.getElementById('text-elements-list');
    
    addTextBtn.addEventListener('click', function() {
      const content = textContent.value.trim();
      if (!content) {
        alert('请输入文字内容');
        return;
      }
      
      // 创建文字元素
      const textElement = document.createElement('div');
      textElement.id = 'text-element-' + nextTextId++;
      textElement.className = 'draggable-text pointer-events-auto';
      textElement.textContent = content;
      
      // 应用样式
      textElement.style.fontSize = currentTextStyle.fontSize + 'px';
      textElement.style.color = currentTextStyle.color;
      textElement.style.textAlign = currentTextStyle.align;
      textElement.style.fontWeight = currentTextStyle.bold ? 'bold' : 'normal';
      textElement.style.fontStyle = currentTextStyle.italic ? 'italic' : 'normal';
      textElement.style.textDecoration = currentTextStyle.underline ? 'underline' : 'none';
      textElement.style.textShadow = currentTextStyle.shadow ? '0 2px 4px rgba(0,0,0,0.5)' : 'none';
      
      // 设置初始位置
      textElement.style.left = '50%';
      textElement.style.top = '50%';
      textElement.style.transform = 'translate(-50%, -50%)';
      
      // 添加到DOM
      textLayer.appendChild(textElement);
      
      // 添加到列表
      const textItem = {
        id: textElement.id,
        content: content,
        element: textElement
      };
      textElements.push(textItem);
      
      // 更新文字元素列表
      updateTextElementsList();
      
      // 清空输入框
      textContent.value = '';
      
      // 使元素可拖动
      makeElementDraggable(textElement);
      
      // 选中新添加的元素
      selectTextElement(textElement);
    });
    
    // 使元素可拖动
    function makeElementDraggable(element) {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      
      element.onmousedown = dragMouseDown;
      
      function dragMouseDown(e) {
        e.preventDefault();
        // 获取鼠标位置
        pos3 = e.clientX;
        pos4 = e.clientY;
        
        // 选中当前元素
        selectTextElement(element);
        
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }
      
      function elementDrag(e) {
        e.preventDefault();
        // 计算新位置
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        
        // 设置新位置
        const rect = textLayer.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        element.style.left = x + 'px';
        element.style.top = y + 'px';
        element.style.transform = 'none';
      }
      
      function closeDragElement() {
        // 停止移动
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
    
    // 选中文字元素
    function selectTextElement(element) {
      // 移除之前选中元素的高亮
      if (selectedTextElement) {
        selectedTextElement.style.outline = 'none';
      }
      
      // 高亮当前选中元素
      element.style.outline = '2px dashed #165DFF';
      selectedTextElement = element;
      
      // 更新文字内容输入框
      const textItem = textElements.find(item => item.id === element.id);
      if (textItem) {
        textContent.value = textItem.content;
      }
      
      // 更新文字样式设置
      currentTextStyle.fontSize = parseInt(element.style.fontSize);
      currentTextStyle.color = element.style.color;
      currentTextStyle.align = element.style.textAlign;
      currentTextStyle.bold = element.style.fontWeight === 'bold';
      currentTextStyle.italic = element.style.fontStyle === 'italic';
      currentTextStyle.underline = element.style.textDecoration === 'underline';
      currentTextStyle.shadow = element.style.textShadow !== 'none';
      
      // 更新UI
      fontSizeInput.value = currentTextStyle.fontSize;
      textColorInput.value = currentTextStyle.color;
      
      // 更新对齐按钮状态
      textAlignBtns.forEach(btn => {
        if (btn.dataset.align === currentTextStyle.align) {
          btn.classList.remove('bg-white', 'border-neutral-300');
          btn.classList.add('bg-primary/10', 'border-primary', 'text-primary');
        } else {
          btn.classList.remove('bg-primary/10', 'border-primary', 'text-primary');
          btn.classList.add('bg-white', 'border-neutral-300');
        }
      });
      
      // 更新样式按钮状态
      [
        { btn: boldBtn, state: currentTextStyle.bold },
        { btn: italicBtn, state: currentTextStyle.italic },
        { btn: underlineBtn, state: currentTextStyle.underline },
        { btn: shadowBtn, state: currentTextStyle.shadow }
      ].forEach(item => {
        if (item.state) {
          item.btn.classList.add('bg-primary/10', 'border-primary', 'text-primary');
        } else {
          item.btn.classList.remove('bg-primary/10', 'border-primary', 'text-primary');
        }
      });
    }
    
    // 更新文字元素列表
    function updateTextElementsList() {
      textElementsList.innerHTML = '';
      
      if (textElements.length === 0) {
        textElementsList.innerHTML = `
          <div class="text-center text-neutral-400 text-sm py-4">
            暂无文字元素
          </div>
        `;
        return;
      }
      
      textElements.forEach(item => {
        const listItem = document.createElement('div');
        listItem.className = 'flex items-center justify-between p-2 border-b border-neutral-200 hover:bg-neutral-50 cursor-pointer';
        listItem.innerHTML = `
          <span class="truncate max-w-[140px]">${item.content}</span>
          <div class="flex space-x-1">
            <button class="edit-text-btn p-1 text-neutral-500 hover:text-primary" data-id="${item.id}">
              <i class="fa fa-pencil"></i>
            </button>
            <button class="delete-text-btn p-1 text-neutral-500 hover:text-red-500" data-id="${item.id}">
              <i class="fa fa-trash-o"></i>
            </button>
          </div>
        `;
        
        // 点击列表项选中文字元素
        listItem.addEventListener('click', function(e) {
          if (!e.target.closest('.edit-text-btn') && !e.target.closest('.delete-text-btn')) {
            const element = document.getElementById(item.id);
            if (element) {
              selectTextElement(element);
            }
          }
        });
        
        // 编辑按钮
        listItem.querySelector('.edit-text-btn').addEventListener('click', function() {
          const element = document.getElementById(item.id);
          if (element) {
            selectTextElement(element);
            // 聚焦到文本输入框
            textContent.focus();
          }
        });
        
        // 删除按钮
        listItem.querySelector('.delete-text-btn').addEventListener('click', function() {
          const element = document.getElementById(item.id);
          if (element) {
            if (selectedTextElement === element) {
              selectedTextElement = null;
            }
            element.remove();
            textElements = textElements.filter(t => t.id !== item.id);
            updateTextElementsList();
